steps:

  # Install node packages
  - name: node:lts
    entrypoint: npm
    args: [ 'install' ]
    dir: 'frontend'
    id: install
    waitFor: [ '-' ]

  # # Lint
  # - name: node:14.4.0
  #   entrypoint: npm
  #   args: [ 'run', 'lint' ]
  #   dir: 'frontend'
  #   id: lint
  #   waitFor:
  #     - install

  # # Build
  # - name: node:14.4.0
  #   entrypoint: npm
  #   args: [ 'run', 'build' ]
  #   dir: 'frontend'
  #   id: build
  #   waitFor: 
  #     - install

  # Install puppeteer dependencies
  - name: ubuntu
    args: 
      - 'apt-get'
      - 'install'
      - 'gconf-service'
      - 'libasound2'
      - 'libatk1.0-0'
      - 'libatk-bridge2.0-0'
      - 'libc6 libcairo2' 
      - 'libcups2' 
      - 'libdbus-1-3'
      - 'libexpat1'
      - 'libfontconfig1' 
      - 'libgcc1'
      - 'libgconf-2-4'
      - 'libgdk-pixbuf2.0-0'
      - 'libglib2.0-0'
      - 'libgtk-3-0'
      -  libnspr4'
      - 'libpango-1.0-0' 
      - 'libpangocairo-1.0-0' 
      - 'libstdc++6'
      - 'libx11-6' 
      - 'libx11-xcb1' 
      - 'libxcb1'
      - 'libxcomposite1'
      - 'libxcursor1'
      - 'libxdamage1'
      - 'libxext6'
      - 'libxfixes3' 
      - 'libxi6' 
      - 'libxrandr2' 
      - 'libxrender1' 
      - 'libxss1' 
      - 'libxtst6' 
      - 'ca-certificates'
      - 'fonts-liberation'
      - 'libappindicator1'
      - 'libnss3'
      - 'lsb-release'
      - 'xdg-utils'
      - 'wget'
    dir: 'frontend'
    id: install-test-dependencies
    waitFor:
      - install

  # Test with out need for a browser (headless)
  - name: node:lts
    entrypoint: npm
    args: [ 'run', 'test-headless']
    dir: 'frontend'
    id: test
    waitFor:
      - install-test-dependencies
